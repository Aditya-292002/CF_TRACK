<div class="grid gap-y-3">
  <div class="card mb-2">
    <div class=" d-flex flex-row  flex flex-wrap justify-content-between mx-2 ">
      <div class="d-flex align-content-center flex-wrap">
        <h5 class="formName" *ngIf="this.MODE == 'A'">Create Issue Raised</h5>
  
        <h5 class="text-xl" *ngIf="this.MODE == 'E'">View Issue Raised</h5>
        <p class="Text_Primary Helper_Text status_container" *ngIf="this.MODE == 'E'">{{ STATUS_NAME }}</p>
        <p class="Text_Primary Helper_Text history_container"
          *ngIf="this.MODE == 'E' && this.COMMENT_HISTORY.length > 0">
          ( Please Check History)
        </p>
      </div>
      <!-- <div class="justify-content-end">
        <button class="p-element prime-button save-button" (click)="goToList()">List</button>
        <button class="p-element prime-button save-button"  data-target="#saveissue" data-toggle="modal" (click)="SaveConfirmationPopUpOpen()">Save</button>
      </div> -->

<div class="d-flex justify-content-end 
">
        <div class="d-flex justify-content-between mr-2">
          <div class="mr-2">
            <button class="p-element prime-button save-button" *ngIf="this.IS_CANCEL == 1"
              (click)="CANCELISSUERAISED()">
              Cancel</button>
          </div>
          <!-- <div class=" mr-2">
            <button class="p-element prime-button save-button"
              *ngIf="this.IS_HISTORY == true && this.COMMENT_HISTORY.length > 0"
              (click)="GETISSUERAISEDHISTORY(1)">History</button>
          </div> -->
          <div class=" mr-2">
            <button class="p-element prime-button save-button" (click)="showHistoryDialog()">
              History</button>
          </div>
          <button class="p-element prime-button save-button" (click)="goToList()">List</button>
        </div>
 
        <div class="mr-2">
          <button class="p-element prime-button save-button" data-target="#saveissue" data-toggle="modal"  (click)="SaveConfirmationPopUpOpen()">Save</button>
        </div>
 
      </div>
      
  </div>
</div>

<!-- Ithun start -->
<form [formGroup]="form">
  <div class="card">
    <div class="card-body">
      <div class="row">
        
        <!-- Issue No -->
        <div class="col-3">
          <label for="issue_no" class="w-50">Issue No.</label>
          <div class="floating-input">
            <input type="text" id="issue_no" class="form-control form-control-sm"
              formControlName="ISSUE_NO" placeholder="Enter Issue No" disabled>
          </div>
        </div>

        <!-- Request Date -->
<div class="col-3">
  <label class="w-50">Date</label>
  <div class="floating-input">
    <input 
      *ngIf="!viewflag" 
      type="date" 
      class="form-control" 
      placeholder="dd-mm-yyyy"
      formControlName="REQUEST_DATE"
    >
    <input 
      *ngIf="viewflag" 
      type="date" 
      class="form-control" 
      [value]="form.get('REQUEST_DATE')?.value | date:'yyyy-MM-dd'" 
      disabled
    >
  </div>
</div>



        <!-- Product Code -->
        <div class="col-6">
          <label class="w-50">Product Code</label>
          <div class="floating-input list-btn">
            <select class="form-control selectpicker show-tick"
              formControlName="PRODUCT_CODE" data-live-search="true" title="Select" [disabled]="viewflag">
              <option *ngFor="let opt of dropdownList1" [value]="opt.Value">{{ opt.Text }}</option>
            </select>
          </div>
        </div>

        <!-- Raised By -->
        <div class="col-3 d-flex flex-column">
          <label class="w-50">Raised By</label>
          <div class="d-flex justify-content-between">
            <div class="d-flex align-items-center">
              <label class="mr-1">Self</label>
              <input type="radio" formControlName="RAISED_BY" [value]="'SELF'" [disabled]="viewflag">
            </div>
            <div class="d-flex align-items-center">
              <label class="mr-1">Other</label>
              <input type="radio" formControlName="RAISED_BY" [value]="'OTHER'" [disabled]="viewflag">
            </div>
          </div>
        </div>

        <!-- Other Name Input -->
        <div class="col-3" *ngIf="form.get('RAISED_BY')?.value === 'OTHER'">
          <label class="small">Enter Name:</label>
          <div class="floating-input">
            <input type="text" class="form-control form-control-sm"
              placeholder="Enter Name" formControlName="OTHER_NAME" [disabled]="viewflag">
          </div>
        </div>

        <!-- Issue Type -->
        <div [ngClass]="form.get('RAISED_BY')?.value === 'OTHER' ? 'col-3' : 'col-5'">
          <label class="w-50">Issue Type</label>
          <div class="floating-input">
            <input type="text" class="form-control" formControlName="ISSUE_TYPE_CODE"
              placeholder="Enter Issue Type" [disabled]="viewflag">
          </div>
        </div>

        <!-- Issue Subject -->
        <div [ngClass]="form.get('RAISED_BY')?.value === 'OTHER' ? 'col-3' : 'col-4'">
          <label class="w-50">Issue Subject</label>
          <div class="floating-input">
            <input type="text" class="form-control" formControlName="ISSUE_SUBJECT"
              placeholder="Issue Subject" [disabled]="viewflag">
          </div>
        </div>

        <!-- Module -->
        <div class="col-3">
          <label class="w-50">Module</label>
          <div class="floating-input">
            <input type="text" class="form-control" formControlName="MODULE_CODE"
              placeholder="Enter Module" [disabled]="viewflag">
          </div>
        </div>

        <!-- Function -->
        <div class="col-3">
          <label class="w-50">Function</label>
          <div class="floating-input">
            <input type="text" class="form-control" formControlName="ISSUE_FUNCTION_CODE"
              placeholder="Enter Function" [disabled]="viewflag">
          </div>
        </div>

        <!-- Priority -->
        <div class="col-6">
          <label class="w-50">Priority</label>
          <div class="floating-input list-btn">
            <select class="form-control selectpicker show-tick" data-live-search="true"
              formControlName="PRIORITY_CODE" title="Select priority" [disabled]="viewflag">
              <option *ngFor="let opt of dropdownList" [value]="opt.PRIORITY_CODE">
                {{ opt.PRIORITY_DESC }}
              </option>
            </select>
          </div>
        </div>

        <!-- CR Stock Issue -->
        <div class="col-6">
          <label>CR Stock Issue</label>
          <div class="floating-input">
            <textarea class="form-control" rows="4" placeholder="Enter Stock Issue"
              formControlName="REASON_ISSUE" [disabled]="viewflag"></textarea>
          </div>
        </div>

        <!-- Description -->
        <div class="col-6">
          <label>Description of CR</label>
          <div class="floating-input">
            <textarea class="form-control" rows="4" placeholder="Enter Description"
              formControlName="DESC_ISSUE" [disabled]="viewflag"></textarea>
          </div>
        </div>

      </div>
    </div>
  </div>
</form>



<div class="card mt-2">

  <div class="card-body mt-3">

    <!-- Add File Button -->
    <button class="btn btn-primary mb-2" (click)="fileInput.click()">Add File</button>
    <input type="file" #fileInput hidden (change)="onFileSelected($event)" />

    <!-- Uploaded Files Table -->
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>File Name</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let file of DOCUMENT_ATTECHED_LIST; let i = index">
          <td>{{ file.name }}</td>
          <td>
            <button class="btn btn-sm" (click)="deleteFile(i)">
              <i class="pi pi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

  </div>
</div>

<div class="modal fade" *ngIf="SaveConfirmationPopUp" #saveissue id="saveissue" tabindex="-1"
  role="dialog" data-keyboard="false" data-backdrop="static" aria-labelledby="saveissue">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- <div class="modal-header">
        <h5 class="modal-title" >Confirmation</h5>
        </div> -->
      <div class="modal-body">
        <div class="form-header text-center">
          <h5>Confirmation</h5>
          <p style="text-align: left;margin-left: 15px;">Are you sure you want to save ?</p>
        </div>
        <!-- <div class="col-md-12" *ngIf="differenceOfreqAndApp">
          <label> Reason to reduce requested amount:<span class="text-danger">*</span></label>
          <div class="floating-input mb-2">
            <textarea name="" id="" cols="2" class="form-control" placeholder="Approve Reason"  [(ngModel)]="REJECT_REASON"
              ></textarea>
          </div>
        </div> -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
          (click)="SAVEISSUEREQUESTMASTER()">Yes</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
      </div>

    </div>
  </div>
</div> 
<p-dialog header="Issue History" [(visible)]="displayHistory" [modal]="true" [closable]="true"
    [style]="{width: '850px'}">
 
    <!-- Bootstrap Card inside Dialog -->
    <div class="card shadow">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-bordered mb-0">
            <thead class="table-secondary">
              <tr>
                <th>Status</th>
                <th>User Name</th>
                <th>Time</th>
                <th>Comment / Remarks</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of historyData">
                <td>
                  <span class="badge" [ngClass]="{
                  'bg-danger': item.status === 'Open',
                  'bg-warning text-dark': item.status === 'In Progress',
                  'bg-success': item.status === 'Closed'
                }">
                    {{ item.status }}
                  </span>
                </td>
                <td>{{ item.userName }}</td>
                <td>{{ item.time }}</td>
                <td>{{ item.comment }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
 
  </p-dialog>
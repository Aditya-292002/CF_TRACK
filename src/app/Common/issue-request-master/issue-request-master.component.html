<div class="grid gap-y-3">
  <div class=" mb-2">
    <div class="d-flex flex-row flex flex-wrap justify-content-between ">
      <div class="d-flex align-content-center flex-wrap align-middle">
        <h5 class="formName form-header" *ngIf="this.MODE == 'A'">
          Raise Issue
        </h5>

        <h5 class="text-xl form-header" *ngIf="this.MODE == 'E'">
          View Issue Raised
        </h5>
        <!-- <p class="Text_Primary form-header Helper_Text status_container" *ngIf="this.MODE == 'E'">{{ STATUS_NAME }}</p> -->
        <p
          class="Text_Primary form-header Helper_Text history_container"
          *ngIf="this.MODE == 'E' && this.COMMENT_HISTORY.length > 0"
        >
          ( Please Check History)
        </p>
      </div>
      <!-- <div class="justify-content-end">
        <button class="p-element prime-button save-button" (click)="goToList()">List</button>
        <button class="p-element prime-button save-button"  data-target="#saveissue" data-toggle="modal" (click)="SaveConfirmationPopUpOpen()">Save</button>
      </div> -->

      <div class="d-flex justify-content-end">
        <div class="d-flex justify-content-between ">
          <div class="mr-2">
            <button
              class="p-element prime-button save-button"
              *ngIf="this.IS_CANCEL == 1"
              (click)="CANCELISSUERAISED()"
            >
              Cancel
            </button>
          </div>
          <!-- <div class=" mr-2">
            <button class="p-element prime-button save-button"
              *ngIf="this.IS_HISTORY == true && this.COMMENT_HISTORY.length > 0"
              (click)="GETISSUERAISEDHISTORY(1)">History</button>
          </div> -->
          <div class="mr-2">
            <!-- <button
              class="p-element prime-button save-button"
              (click)="GETISSUERAISEDHISTORY(1); showHistoryDialog()"
            >
              History
            </button> -->
             <button
          class="btn btn-secondary mr-1"
          (click)="GETISSUERAISEDHISTORY(1); showHistoryDialog()"
        >
          History
  </button>
          </div>
          <!-- <button
            class="p-element prime-button secondary-button"
            (click)="goToList()"
          >
            List
          </button> -->
             <button
          class="btn btn-secondary "
           (click)="goToList()"
        >
          List
  </button>
        </div>

        <div class="mr-2" *ngIf="!viewflag">
          <button
            class="p-element prime-button save-button"
            data-target="#saveissue"
            data-toggle="modal"
            (click)="SaveConfirmationPopUpOpen()"
          >
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ithun start -->
  <form [formGroup]="form">
    <div class="card card-padding-none">
      <div class="card-body">
        <div class="row row-gap">
          <!-- Issue No -->
          <div class="col-3">
            <label for="issue_no" class="w-50 label-13px">Issue No.</label>
            <div class="floating-input">
              <input
                type="text"
                id="issue_no"
                class="form-control form-control-sm"
                formControlName="ISSUE_NO"
                placeholder="Enter Issue No"
                disabled
              />
            </div>
          </div>

          <!-- Request Date -->

           <div class="col-3">
          <label class="w-50 label-13px">Date</label>
							<div class="floating-input mb-2">
								<input type="text" class="form-control" placeholder="dd-mm-yyyy" formControlName="REQUEST_DATE" [(ngModel)]="REQUEST_DATE" (change)="ChangeFDate()" readonly>
								<!-- <app-date-picker id="reqdate" [(ngModel)]="JV_DATE" #reqdate class="date-input" [ngModelOptions]="{standalone: true}"></app-date-picker> -->
								<div class="date-input">
									<mat-form-field fxFlex="100" appearance="fill">
										<!-- <mat-icon matDatepickerToggleIcon (click)="clearDate($event)">clear</mat-icon> -->
										<mat-datepicker-toggle matPrefix [for]="picker2"  id='cal2' #cal2></mat-datepicker-toggle>
										<input class="form-control" placeholder="dd-mm-yyyy" (dateChange)="ChangeFDate()" [value]="REQUEST_DATE" matInput [(ngModel)]="REQUEST_DATE" [ngModelOptions]="{standalone: true}" [matDatepicker]="picker2" [min]="minDate"  [disabled]="true" readonly />
							  			<mat-datepicker #picker2 id="picker2"></mat-datepicker>
									</mat-form-field>
								</div>
							</div>
        </div>
 

          <!-- Project Name -->
          <div class="col-3">
            <label class="w-50 label-13px">Project Name</label>
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                formControlName="PRODUCT_CODE"
                data-live-search="true"
                title="Select"
                [attr.disabled]="viewflag ? '' : null"
              >
                <option
                  *ngFor="let opt of PROJECT_LIST"
                  [value]="opt.PROJ_CODE"
                >
                  {{ opt.PROJ_NAME }}
                </option>
              </select>
            </div>
          </div>

          <!-- Issue No -->
          <div class="col-3">
            <label for="issue_no" class="w-50 label-13px">Cust Ref No.</label>
            <div class="floating-input">
              <input
                type="text"
                id="issue_no"
                class="form-control form-control-sm"
                formControlName="Cust_REF_NO"
                placeholder="Enter Cust Ref No"
                [attr.disabled]="viewflag ? '' : null"
              />
            </div>
          </div>

          <!-- Raised By -->
          <div class="col-3 d-flex flex-column">
            <label class="w-50 label-13px">Raised By</label>
            <div class="d-flex radio-btn-gap">
              <div class="d-flex align-items-center">
                <input
                  class="mr-2"
                  type="radio"
                  formControlName="RAISED_BY"
                  [value]="'SELF'"
                  [attr.disabled]="viewflag ? '' : null"
                />
                <label class="label-13px">Self</label>
              </div>
              <div class="d-flex align-items-center">
                <input
                  class="mr-2"
                  type="radio"
                  formControlName="RAISED_BY"
                  [value]="'OTHER'"
                  [attr.disabled]="viewflag ? '' : null"
                />
                <label class="label-13px">Other</label>
              </div>
            </div>
          </div>

          <!-- Other Name Input -->
          <div class="col-3">
            <label class="small label-13px">Raised by</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Raised by Name"
                formControlName="OTHER_NAME"
                [attr.disabled]="
                  viewflag
                    ? ''
                    : null || form.get('RAISED_BY')?.value === 'OTHER'
                    ? null
                    : ''
                "
              />
            </div>
          </div>

          <!-- Issue Type -->
          <!-- [ngClass]="form.get('RAISED_BY')?.value === 'OTHER' ? 'col-3' : 'col-5'" -->
          <div class="col-3">
            <label class="w-50 label-13px">Issue Type</label>
            <!-- <div class="floating-input">
              <input type="text" class="form-control" formControlName="ISSUE_TYPE_CODE" placeholder="Enter Issue Type"
                [attr.disabled]="viewflag ? '' : null">
            </div> -->
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                data-live-search="true"
                formControlName="ISSUE_TYPE_CODE"
                title="Select issue type"
                [attr.disabled]="viewflag ? '' : null"
              >
                <option
                  *ngFor="let opt of ISSUE_LIST"
                  [value]="opt.ISSUE_TYPE_CODE"
                >
                  {{ opt.ISSUE_TYPE_DESC }}
                </option>
              </select>
            </div>
          </div>

          <!-- Priority -->
          <div class="col-3">
            <label class="w-50 label-13px">Priority</label>
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                data-live-search="true"
                formControlName="PRIORITY_CODE"
                title="Select priority"
                [attr.disabled]="viewflag ? '' : null"
              >
                <option
                  *ngFor="let opt of PRIORITY_LIST"
                  [value]="opt.PRIORITY_CODE"
                >
                  {{ opt.PRIORITY_DESC }}
                </option>
              </select>
            </div>
          </div>

          <!-- Module -->
          <div class="col-3">
            <label class="w-50 label-13px">Module</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                formControlName="MODULE_CODE"
                placeholder="Enter Module"
                [attr.disabled]="viewflag ? '' : null"
              />
            </div>
          </div>

          <!-- Function -->
          <div class="col-3">
            <label class="w-50 label-13px">Function</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                formControlName="ISSUE_FUNCTION_CODE"
                placeholder="Enter Function"
                [attr.disabled]="viewflag ? '' : null"
              />
            </div>
          </div>

          <!-- Issue Subject -->
          <div class="col-6">
            <label class="w-50 label-13px">Issue Subject</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                formControlName="ISSUE_SUBJECT"
                placeholder="Issue Subject"
                [attr.disabled]="viewflag ? '' : null"
              />
            </div>
          </div>

          <!-- CR Stock Issue -->
          <div class="col-6">
            <label class="label-13px">CR/Issue</label>
            <div class="floating-input">
              <textarea
                class="form-control"
                rows="6"
                placeholder="Enter CR/Issue"
                formControlName="REASON_ISSUE"
                [attr.disabled]="viewflag ? '' : null"
              ></textarea>
            </div>
          </div>
          <div class="col-6">
            <div class="col-12 pt-2">
              <button
                class="btn custom-file-uploader"
                (click)="fileInput.click()"
              >
                <i class="pi pi-upload mr-2"></i>Add File
              </button>
              <input
                type="file"
                #fileInput
                hidden
                (change)="onFileSelected($event)"/>
              <small class="mb-0">(Accepted file formats: PDF, JPG, PNG, Xls, Xlsx, Doc, Docx)</small>
            </div>
            <div class="col-12 pt-2">
              <table class="table-theam-1 row_bgcolor_1">
                <thead>
                  <tr class="width-100percent">
                    <th class="width-85percent">File Name</th>
                    <th class="width-15percent">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let file of INITIAL_DOC_LIST; let i = index"
                  >
                    <td>{{ file.FILE_NAME }}</td>
                    <td>
                      <button
                        class="btn btn-sm card-padding-none mr-2"
                        (click)="viewDocument(file)"
                        title="View Document"
                      >
                        <i class="pi pi-eye"></i>
                      </button>
                      
                      <button
                        type="button"
                        class="btn btn-sm card-padding-none"
                        (click)="deleteFile(i, fileInput)"
                        title="Delete file">
                        <i class="pi pi-trash"></i>
                      </button>

                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- Description -->
          <!-- <div class="col-6">
            <label class="label-13px">Description of CR</label>
            <div class="floating-input">
              <textarea class="form-control" rows="4" placeholder="Enter Description" formControlName="DESC_ISSUE"
                [attr.disabled]="viewflag ? '' : null"></textarea>
            </div>
          </div> -->
        </div>
<div class=" p-2 mt-2">
  <div class="">

    <!-- Row 1: Radio Buttons -->
    <div class="row row-gap">
      <!-- You may have your radio buttons here -->
    </div>

    <!-- Row 2: Reason Field (Visible only when CLOSE is selected) -->
    <div class="form-group mt-2" *ngIf="checkStatus === '42'">
      <label class="font-weight-bold small">Reason</label>
      <textarea
        class="form-control"
        rows="2"
        formControlName="DEVELOPER_COMMENT"
        placeholder="Enter Reason"
        disabled
      ></textarea>
    </div>

    <!-- Row 3: Other Fields (Visible only when OK is selected) -->
    <div  class="row mt-3" *ngIf="checkStatus === '40'">
      
      <!-- Delivery By -->
      <!-- <div class="col-3">
        <label class="w-50 label-13px">Delivery By</label>
        <div class="floating-input">
          <input
            *ngIf="!viewflag"
            type="date"
            class="form-control"
            placeholder="dd-mm-yyyy"
            formControlName="DELIVERY_BY"
            disabled
          />
          <input
            *ngIf="viewflag"
            type="date"
            class="form-control"
            [value]="form.get('DELIVERY_BY')?.value | date : 'yyyy-MM-dd'"
            [attr.disabled]="viewflag ? '' : null"
          />
        </div>
      </div> -->
 <div class="col-4">
          <label class="w-50 label-13px">Delivery By</label>
							<div class="floating-input mb-2">
								<input type="text" class="form-control" placeholder="dd-mm-yyyy" formControlName="DELIVERY_BY" [(ngModel)]="DELIVERY_BY" (change)="ChangeFDate()" readonly>
								<!-- <app-date-picker id="reqdate" [(ngModel)]="JV_DATE" #reqdate class="date-input" [ngModelOptions]="{standalone: true}"></app-date-picker> -->
								<div class="date-input">
									<mat-form-field fxFlex="100" appearance="fill">
										<!-- <mat-icon matDatepickerToggleIcon (click)="clearDate($event)">clear</mat-icon> -->
										<mat-datepicker-toggle matPrefix [for]="picker3"  id='cal3' #cal3></mat-datepicker-toggle>
										<input class="form-control" placeholder="dd-MMM-yyyy" (dateChange)="ChangeFDate()" [value]="DELIVERY_BY" matInput [(ngModel)]="DELIVERY_BY" [ngModelOptions]="{standalone: true}" [matDatepicker]="picker3" [min]="minDate"  [disabled]="true" readonly />
							  			<mat-datepicker #picker3 id="picker3"></mat-datepicker>
									</mat-form-field>
								</div>
							</div>
        </div>
    

      <!-- Est. Man Hours (text input) -->
      <div class="col-4">
        <label class="w-50 label-13px">Est. Man Hours</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control"
            formControlName="EST_HOURS"
            placeholder="Enter Est. Man Hours"
            [attr.disabled]="viewflag ? '' : null"
          />
        </div>
      </div>

      <!-- Priority -->
      <div class="col-4">
        <label class="w-50 label-13px">Resolution</label>
        <div class="floating-input list-btn">
          <select
            class="form-control selectpicker show-tick"
            data-live-search="true"
            formControlName="RESOLUTION_CODE"
            title="Select Resolution"
            [attr.disabled]="viewflag ? '' : null"
          >
            <option
              *ngFor="let res of RESOLUTION_LIST"
              [value]="res.RESOLUTION_CODE"
            >
              {{ res.RESOLUTION_NAME }}
            </option>
          </select>
        </div>
      </div>

      <!-- PM Explanation -->
      <div class="col-6">
        <label class="label-13px">PM Explanation</label>
        <div class="floating-input">
          <textarea
            class="form-control"
            rows="6"
            placeholder="PM Explanation"
            formControlName="DEVELOPER_COMMENT"
            [attr.disabled]="viewflag ? '' : null"
          ></textarea>
        </div>
      </div>

<div class="col-6">
            <!-- <div class="col-12 pt-2">
              <button
                class="btn custom-file-uploader"
                (click)="fileInput.click()"
              >
                <i class="pi pi-upload mr-2"></i>Add File
              </button>
              <input
                type="file"
                #fileInput
                hidden
                (change)="onFileSelected($event)"/>
              <small class="mb-0">(Accepted file formats: PDF, JPG, PNG, Xls, Xlsx, Doc, Docx)</small>
            </div> -->
            <label for="" class="ml-3">Uploaded Document List</label>
            <div class="col-12  w-100">
              <table class="table-theam-1 row_bgcolor_1">
                <thead>
                  <tr>
                    <th class=" ">File Name</th>
                    <th class="">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let file of RESOLVE_DOC_LIST; let i = index"
                  >
                    <td>{{ file.FILE_NAME }}</td>
                    <td>
                      <button
                        class="btn btn-sm card-padding-none mr-2"
                        (click)="viewDocument(file)"
                        title="View Document"
                      >
                        <i class="pi pi-eye"></i>
                      </button>
                      
                      <button
                        type="button"
                        class="btn btn-sm card-padding-none"
                        (click)="deleteFile(i, fileInput)"
                        title="Delete file">
                        <i class="pi pi-trash"></i>
                      </button>

                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

    </div> <!-- end of Row 3 -->

  </div> <!-- end of card-body -->
</div> 
        
      </div>
    </div>
  </form>

  <!-- end of card -->

 

  <!-- <div class="card mt-2 card-padding-none">
 
    <div class="card-body">
 

      <button class="btn prime-button secondary-button mb-2" (click)="fileInput.click()">
        <i class="pi pi-upload mr-2"></i>Add File</button>
      <input type="file" #fileInput hidden (change)="onFileSelected($event)" />
 
    
      <table class="table table-bordered file-table">
        <thead>
          <tr>
            <th class="file-table-th ">File Name</th>
            <th class="file-table-action">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let file of DOCUMENT_ATTECHED_LIST; let i = index">
            <td>{{ file.FILE_NAME }}</td>
            <td>
               <button class="btn btn-sm" (click)="viewDocument(file)">
              <i class="pi pi-eye"></i>
            </button>
              <button class="btn btn-sm" (click)="deleteFile(i)">
                <i class="pi pi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
 
    </div>
  </div> -->

  <div
    class="modal fade"
    *ngIf="SaveConfirmationPopUp"
    #saveissue
    id="saveissue"
    tabindex="-1"
    role="dialog"
    data-keyboard="false"
    data-backdrop="static"
    aria-labelledby="saveissue"
  >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirmation</h5>
        </div>
        <div class="modal-body">
          <div class="form-header text-center">
            <!-- <h5>Confirmation</h5> -->
            <p style="text-align: left; margin-left: 15px">
              Are you sure you want to save ?
            </p>
          </div>
          <!-- <div class="col-md-12" *ngIf="differenceOfreqAndApp">
          <label> Reason to reduce requested amount:<span class="text-danger">*</span></label>
          <div class="floating-input mb-2">
            <textarea name="" id="" cols="2" class="form-control" placeholder="Approve Reason"  [(ngModel)]="REJECT_REASON"
              ></textarea>
          </div>
        </div> -->
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-dismiss="modal"
            (click)="SAVEISSUEREQUESTMASTER()"
          >
            Yes
          </button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            No
          </button>
        </div>
      </div>
    </div>
  </div>

</div>
 <p-dialog
  header="History Details"
  [(visible)]="displayHistory"
  [modal]="true"
  [style]="{ width: '50rem' }"
>
<div class="">
<div class="comment-history">
  <div 
    class="comment-item" 
    *ngFor="let data of COMMENT_HISTORY; let i = index"
  >
    <!-- Header -->
    <div 
      class="comment-header"
      (click)="data.expanded = !data.expanded"
    >
      <span class="status-text">{{ data.CREATEDON }},  {{ data.USER_NAME }}</span>
 <!-- <span class="P"></span> -->
      <div class="header-right">
        <p class="status">
          <i class="pi pi-circle-fill mr-1" [ngClass]="data.STATUS_COLOR_NAME"></i>
          {{ data.STATUS_NAME }}
        </p>
        <!-- <p class="date">{{ data.CREATEDON }}</p> -->
        <i 
          class="pi toggle-icon"
          [ngClass]="data.expanded ? 'pi-chevron-up' : 'pi-chevron-down'"
        ></i>
      </div>
    </div>

    <!-- Comment Section -->
    <div class="comment-body" *ngIf="data.expanded">
      <label 
        for="comment-{{ i }}" 
        class="comment-label"
      >Comment :-</label>

      <textarea
        id="comment-{{ i }}"
        rows="3"
        pInputTextarea
        class="comment-textarea"
        [(ngModel)]="data.COMMENTS"
        [disabled]="true"
      ></textarea>
    </div>
  </div>
</div>

</div>

</p-dialog>

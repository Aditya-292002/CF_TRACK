<div class="card p-2 mb-2">
  <div class="card-body d-flex flex-wrap justify-content-between align-items-center">
    
    <!-- Left section -->
    <div class="d-flex align-items-center flex-wrap">
      <h5 class="card-title mb-0 mr-2">PM Confirmation</h5>
      <p class="text-primary small mb-0">(Please Check History)</p>
    </div>

    <!-- Right section: Buttons -->
    <div class="d-flex align-items-center flex-wrap">
      <button type="button" class="btn btn-primary btn-sm mr-2">History</button>

      <!-- Save button (visible only if viewflag is false) -->
      <div *ngIf="!viewflag" class="mr-2">
        <button 
          class="btn btn-success btn-sm" 
          data-target="#saveissue" 
          data-toggle="modal"
          (click)="SaveConfirmationPopUpOpen()">
          Save
        </button>
      </div>

      <button type="button" class="btn btn-outline-primary btn-sm" (click)="goToList()">List</button>
    </div>

  </div>
</div>


<div class="card mb-3 p-3">
  <div class="row">

    <!-- Issue No -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Issue No.</label>
      <p class="text-secondary small" *ngIf = "ISSSUE_NO !== null || ISSSUE_NO !== '' || ISSSUE_NO !== undefined">
        {{ISSSUE_NO }}
      </p>
      <p class="text-secondary small" *ngIf = "ISSSUE_NO === null || ISSSUE_NO === '' || ISSSUE_NO === undefined">
        NA
      </p>
    </div>

    <!-- Date -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Date</label>
      <p class="text-secondary small" *ngIf = "REQUEST_DATE !== null || REQUEST_DATE !== '' || REQUEST_DATE !== undefined">
        {{ REQUEST_DATE }}
      </p>
      <p class="text-secondary small" *ngIf = "REQUEST_DATE === null || REQUEST_DATE === '' || REQUEST_DATE === undefined">
        NA
      </p>
    </div>

    <!-- Created By -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Created By</label>
      <p class="text-secondary small" *ngIf =  "REQUESTER_NAME !== ''">
        {{ REQUESTER_NAME }}
      </p>
      <p class="text-secondary small" *ngIf = "REQUESTER_NAME === null || REQUESTER_NAME === '' || REQUESTER_NAME === undefined">
        NA
      </p>
    </div>

    <!-- Raised By -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Raised By</label>
      <p class="text-secondary small" *ngIf = " RAISED_BY_NAME !== ''">
        {{ RAISED_BY_NAME }}
      </p>
      <p class="text-secondary small" *ngIf = "RAISED_BY_NAME === null || RAISED_BY_NAME === '' || RAISED_BY_NAME === undefined">
        NA
      </p>
    </div>

    <!-- Issue Type -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Issue Type</label>
      <p class="text-secondary small" *ngIf = "ISSUE_TYPE_DESC !== null || ISSUE_TYPE_DESC !== '' || ISSUE_TYPE_DESC !== undefined">
        {{ISSUE_TYPE_DESC }}
      </p>
      <p class="text-secondary small" *ngIf = "ISSUE_TYPE_DESC === null || ISSUE_TYPE_DESC === '' || ISSUE_TYPE_DESC === undefined">
        NA
      </p>
    </div>

    <!-- Priority -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Priority</label>
      <p class="text-secondary small" *ngIf = "PRIORITY_DESC !== null || PRIORITY_DESC !== '' || PRIORITY_DESC !== undefined">
        {{ PRIORITY_DESC }}
      </p>
      <p class="text-secondary small" *ngIf = "PRIORITY_DESC === null || PRIORITY_DESC === '' || PRIORITY_DESC === undefined">
        NA
      </p>
    </div>

    <!-- Module -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Module</label>
      <p class="text-secondary small" *ngIf = "MODULE_CODE !== null || MODULE_CODE !== '' || MODULE_CODE !== undefined">
        {{MODULE_CODE }}
      </p>
      <p class="text-secondary small" *ngIf = "MODULE_CODE === null || MODULE_CODE === '' || MODULE_CODE === undefined">
        NA
      </p>
    </div>

    <!-- Function -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Function</label>
      <p class="text-secondary small" *ngIf = "FUNCTION_CODE !== null || FUNCTION_CODE !== '' || FUNCTION_CODE !== undefined">
        {{ FUNCTION_CODE }}
      </p>
      <p class="text-secondary small" *ngIf = "FUNCTION_CODE === null || FUNCTION_CODE === '' || FUNCTION_CODE === undefined">
        NA
      </p>
    </div>

    <!-- Issue Subject -->
    <div class="col-md-3 mb-2">
      <label class="font-weight-bold  small">Issue Subject</label>
      <p class="text-secondary small" *ngIf = "ISSUE_SUBJECT !== null || ISSUE_SUBJECT !== '' || ISSUE_SUBJECT !== undefined">
        {{ ISSUE_SUBJECT }}
      </p>
      <p class="text-secondary small" *ngIf = "ISSUE_SUBJECT === null || ISSUE_SUBJECT === '' || ISSUE_SUBJECT === undefined">
        NA
      </p>
    </div>

    <!-- Reason / Description of Issue/CR -->
    <!-- <div class="col-12 mb-2" >
      <label class="font-weight-bold  small" >Reason of CR</label>
      <label class="font-weight-bold  small">Reason of Issue</label>
      <label class="font-weight-bold  small">Description of CR</label>

      <p class="text-secondary small" >
       
          Reason of Issue
      </p>
      <p class="text-secondary small" >NA</p>

      <p class="text-secondary small" >
  
            Description of Issue
      </p>
      <p class="text-secondary small" >NA</p>
    </div> -->

    <!-- Propose Delivery & Est Hours -->
    <!-- <div class="col-md-3 mb-2" >
      <label class="font-weight-bold  small">Propose New</label>
      <p class="text-secondary small">{{ "PROPOSE_DELIVERY_BY" }}</p>
    </div> -->
    <!-- <div class="col-md-3 mb-2" >
      <label class="font-weight-bold  small">Est. Hours</label>
      <p class="text-secondary small">{{ "PROPOSE_HOURS" }} Hr</p>
    </div> -->

    <!-- Uploaded Document List -->
    <div class="col-md-9 mb-2">
      <label class="font-weight-bold  small">Uploaded Document List</label>
      <table class="table table-sm table-bordered">
        <thead class="thead-light">
          <tr>
            <th>File Name</th>
            <th>Uploaded By</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of DEVELOPER_DOCUMENT_LIST1">
            <td>{{ data.FILE_NAME }}</td>
            <td>{{ data.UPLOADEDBY }}</td>
            <td>{{ data.DATE }}</td>
            <td>
              <button 
                      type="button"
                      class="btn btn-sm mr-1"
                    >
                <i class="fa fa-eye"></i>
              </button>
              <button type="button"
                      class="btn  btn-sm"
                     >
                <i class="fa fa-download"></i>
              </button>
             
                <!-- <div>
                  <img [src]="data.DOC_BASE64" style="height: 200px; width: 200px;" />
                </div> -->
           
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>

<form [formGroup]="form">

<div class="card p-2 mb-2">
  <div class="card-body">

    <!-- Row 1: Radio Buttons -->
    <div class="d-flex align-items-center mb-3">
      <div class="form-check form-check-inline">
        <input
          class="form-check-input"
          type="radio"
          id="statusOk"
          name="developerStatus"
          formControlName="DEVELOPER_STATUS"
          value="OK"
          (change)="developerStatus = 'OK'"
        />
        <label class="form-check-label" for="statusOk">OK</label>
      </div>

      <div class="form-check form-check-inline">
        <input
          class="form-check-input"
          type="radio"
          id="statusClose"
          name="developerStatus"
          formControlName="DEVELOPER_STATUS"
          value="CLOSE"
          (change)="developerStatus = 'CLOSE'"
        />
        <label class="form-check-label" for="statusClose">Close</label>
      </div>
    </div>

    <!-- Row 2: Reason Field (Visible only when CLOSE is selected) -->
    <div class="form-group mt-2" *ngIf="developerStatus === 'CLOSE'">
      <label class="font-weight-bold small">Reason</label>
      <textarea
        class="form-control"
        rows="2"
        formControlName="DEVELOPER_COMMENT"
        placeholder="Enter Reason"
      ></textarea>
    </div>

    <!-- Row 3: Other Fields (Visible only when OK is selected) -->
    <div *ngIf="developerStatus === 'OK'">

      <div class="form-row mb-3">
        <div class="col-md-4">
          <label class="font-weight-bold small">Delivery By</label>
          <input
            type="date"
            class="form-control"
            formControlName="DELIVERY_BY"
          />
        </div>

        <div class="col-md-4">
          <label class="font-weight-bold small">
            Est. Hours <span class="text-danger">*</span>
          </label>
          <input
            type="number"
            class="form-control"
            formControlName="EST_HOURS"
            placeholder="Enter Est. Hours"
            maxlength="3"
          />
        </div>

        <div class="col-md-4">
          <label class="font-weight-bold small">
            Resolution <span class="text-danger">*</span>
          </label>
          <select class="form-control" formControlName="RESOLUTION_CODE">
            <option
              *ngFor="let res of RESOLUTION_LIST"
              [value]="res.RESOLUTION_CODE"
            >
              {{ res.RESOLUTION_NAME }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="col-md-6 mb-3">
          <label class="font-weight-bold small">
            PM Explanation <span class="text-danger">*</span>
          </label>
          <textarea
            class="form-control"
            rows="4"
            formControlName="DEVELOPER_COMMENT"
            placeholder="Enter PM Explanation"
          ></textarea>
        </div>

        <div class="col-6 d-flex flex-column">
        <div class=" pt-6 mt-3">
          <button class="btn custom-file-uploader" (click)="fileInput.click()">
            <i class="pi pi-upload mr-2"></i>Add File
          </button>
          <input type="file" #fileInput hidden (change)="onFileSelected($event)" />
        </div>

  <!-- Table below Add File button -->
  <div>
    <table class="table-theam-1 row_bgcolor_1 w-100">
      <thead>
        <tr>
          <th>File Name</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let file of DOCUMENT_ATTECHED_LIST; let i = index">
          <td>{{ file.FILE_NAME }}</td>
          <td>
            <button class="btn btn-sm card-padding-none mr-2" (click)="viewDocument(file)">
              <i class="pi pi-eye"></i>
            </button>
            <button class="btn btn-sm card-padding-none" (click)="deleteFile(i)">
              <i class="pi pi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>



      </div>
    </div>
  </div>
</div>
</form>

<div class="modal fade" *ngIf="SaveConfirmationPopUp" #saveissue id="saveissue" tabindex="-1" role="dialog"
    data-keyboard="false" data-backdrop="static" aria-labelledby="saveissue">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" >Confirmation</h5>
        </div>
        <div class="modal-body">
          <div class="form-header text-center">
            <!-- <h5>Confirmation</h5> -->
            <p style="text-align: left;margin-left: 15px;">Are you sure you want to save ?</p>
          </div>
          <!-- <div class="col-md-12" *ngIf="differenceOfreqAndApp">
          <label> Reason to reduce requested amount:<span class="text-danger">*</span></label>
          <div class="floating-input mb-2">
            <textarea name="" id="" cols="2" class="form-control" placeholder="Approve Reason"  [(ngModel)]="REJECT_REASON"
              ></textarea>
          </div>
        </div> -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal"
            (click)="SAVE_PM_CONFIRMATION_MASTER()">Yes</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
        </div>
 
      </div>
    </div>
  </div>
<app-spinner [startSpinner]="spinner" *ngIf="spinner"></app-spinner>

<div class="" *ngIf="isViewInvoiceCancle">
  <div class="d-flex justify-content-between">
    <h5 class="formName col-md-4">{{ sharedService.formName }}</h5>
    <div class="d-flex col-md-8 justify-content-end">
      <button
        class="btn btn-secondary mr-2"
        *ngIf="isViewInvoiceCancle"
        (click)="GetCreditNoteList()"
      >
        List
      </button>
      <!-- <button class="btn btn-secondary  mr-2" *ngIf="!isViewInvoiceCancle" (click)="backToForm()"
                ><i class="fas fa-angle-left mr-1" ></i>Back</button> -->
      <button
        class="btn btn-secondary"
        *ngIf="isViewInvoiceCancle"
        data-toggle="modal"
        data-target="#savecreditnote"
        (click)="FormValidation()"
      >
        Save
      </button>
    </div>
  </div>
</div>

<div *ngIf="isViewInvoiceCancle">
  <div class="mt-2 col-md-12">
    <div class="row">
      <div class="col-md-4 p-0">
        <div class="row card">
          <!-- <div class="col-md-6">
                                <label>Company :</label>
                                <div class="floating-input  list-btn">
                                    <select class="selectpicker show-tick" [(ngModel)]="COMPANY_CODE" data-live-search="true" title="Select">
                                        <option *ngFor="let opt of company_list; let i=index" 
                                        [selected]="opt.COMPANY_CODE == this.COMPANY_CODE"
                                         [value]="opt.COMPANY_CODE" disabled >{{ opt.COMPANY_NAME }}</option>
                                    </select>
                                    <button type="button" class="close" onclick="resetDropdown('COMPANY_CODE')" (click)="this.COMPANY_CODE.reset()"   aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label>Location :</label>
                                <div class="floating-input  list-btn" >
                                    <select class="selectpicker show-tick"  [(ngModel)]="LOCATION_CODE" data-live-search="true"  title="Select">
                                        <option *ngFor="let opt of _location_list; let i=index" 
                                        [selected]="opt.LOCATION_CODE == this.LOCATION_CODE"
                                         [value]="opt.LOCATION_CODE" disabled>{{ opt.LOCATION_NAME }}</option>
                                    </select>
                                    <button type="button" class="close" onclick="resetDropdown('LOCATION_CODE')" (click)="this.LOCATION_CODE.reset()" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>-->
          <!-- <div class="col-md-6">
                                <label>State :</label>
                                <div class="floating-input  list-btn">
                                    <select class="selectpicker show-tick"  [(ngModel)]="STATE_CODE" disabled data-live-search="true"  title="Select">
                                        <option *ngFor="let opt of state_list; let i=index" 
                                        [selected]="opt.STATE_CODE == this.STATE_CODE"
                                         [value]="opt.STATE_CODE" disabled >{{ opt.STATE_NAME }}</option>
                                    </select>
                                    <button type="button" class="close" onclick="resetDropdown('STATE_CODE')"  (click)="this.STATE_CODE.reset()" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>  -->
          <!-- <div class="col-md-6">
                                <label>Request No :</label>
                                <div class="floating-input list-btn">
                                    <select class="selectpicker show-tick"  [(ngModel)]="REQ_ID" disabled data-live-search="true" title="Search">
                                        <option *ngFor="let opt of invoice_list; let i=index" 
                                        [selected]="opt.REQ_ID == this.REQ_ID"
                                        [value]="opt.REQ_ID" disabled>{{ opt.REQ_NO }}</option>                     
                                    </select>
                                    <button type="button" class="close" onclick="resetDropdown('REQ_ID')" (click)="this.REQ_ID.reset();" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div> -->
          <div class="col-md-12">
            <label>Invoice Type:</label>
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                [(ngModel)]="DOCTYPE_CODE"
                disabled
                data-live-search="true"
                title="Search"
              >
                <option
                  *ngFor="let opt of invoice_type_list; let i = index"
                  [selected]="opt.DOCTYPE_CODE == this.DOCTYPE_CODE"
                  [value]="opt.DOCTYPE_CODE"
                  disabled
                >
                  {{ opt.DOCTYPE_DESC }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-12">
            <label>Invoice No :</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                [(ngModel)]="BILLING_NO"
                maxlength="20"
                OnlyNumber="true"
                placeholder="Invoice No."
                disabled
              />
            </div>
          </div>
          <!-- <div class="col-md-6">
                                <label>Financial Year  :</label>
                                <div class="floating-input  list-btn">
                                    <select class="selectpicker show-tick"  [(ngModel)]="FYEAR" disabled data-live-search="true" title="Select">
                                        <option *ngFor="let opt of fyear_list; let i=index" 
                                        [selected]="opt.FYEAR == this.FYEAR"
                                         [value]="opt.FYEAR" disabled >{{ opt.FYEAR_DESC }}</option>
                                    </select>
                                </div>
                            </div> -->
          <div class="col-md-12">
            <label>Invoice Date :</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                [(ngModel)]="BILLING_DATE"
                readonly
                disabled
              />
              <app-date-picker
                [(ngModel)]="BILLING_DATE"
                class="date-input"
                [maxdate]="maxdate"
                [mindate]="min_date"
                [disabled]="true"
                [ngModelOptions]="{ standalone: true }"
              ></app-date-picker>
            </div>
          </div>
          <div class="col-md-12 mb-2">
            <label>Due Date :</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                [(ngModel)]="DUE_DATE"
                readonly
                disabled
              />
              <app-date-picker
                [(ngModel)]="DUE_DATE"
                class="date-input"
                [maxdate]="maxdate"
                [mindate]="min_date"
                [disabled]="true"
                [ngModelOptions]="{ standalone: true }"
              ></app-date-picker>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="row card">
          <div class="col-md-4">
            <label>Customer : </label>
            <!-- <div class="floating-input list-btn">
                                    <select class="form-control selectpicker show-tick"   [(ngModel)]="CUST_CODE" disabled data-live-search="true"  title="Search">
                                        <option *ngFor="let opt of customer_list; let i=index" 
                                        [selected]="opt.CUST_CODE == this.CUST_CODE"
                                            [value]="opt.CUST_CODE" disabled>{{ opt.CUST_NAME }}</option>                 
                                    </select>
                                </div> -->
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                maxlength="50"
                [(ngModel)]="CUST_NAME"
                disabled
                placeholder=""
              />
            </div>
          </div>
          <div class="col-md-4">
            <label>Project : </label>
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                [(ngModel)]="PROJ_CODE"
                disabled
                data-live-search="true"
                title="Search"
              >
                <option
                  *ngFor="let opt of _project_list; let i = index"
                  [selected]="opt.PROJ_CODE == this.PROJ_CODE"
                  [value]="opt.PROJ_CODE"
                  disabled
                >
                  {{ opt.PROJ_NAME }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <label>Template :</label>
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                [(ngModel)]="TEMPLATE_CODE"
                disabled
                data-live-search="true"
                title="Search"
              >
                <option
                  *ngFor="let opt of templete_list; let i = index"
                  [selected]="opt.TEMPLATE_CODE == this.TEMPLATE_CODE"
                  [value]="opt.TEMPLATE_CODE"
                  disabled
                >
                  {{ opt.TEMPLATE_DESC }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <label>PO No :</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                maxlength="50"
                [(ngModel)]="PO_NO"
                disabled
                placeholder="PO No."
              />
            </div>
          </div>
          <div class="col-md-4">
            <label>PO Date :</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                [(ngModel)]="PO_DATE"
                readonly
                disabled
              />
              <app-date-picker
                [(ngModel)]="PO_DATE"
                class="date-input"
                [maxdate]=""
                [disabled]="true"
                [ngModelOptions]="{ standalone: true }"
              ></app-date-picker>
            </div>
          </div>
          <div class="col-md-4">
            <label>Kind Attention :</label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                maxlength="50"
                [(ngModel)]="KIND_ATTN"
                disabled
                placeholder="Kind Attention"
              />
            </div>
          </div>
          <div class="col-md-4">
            <label>Currency :</label>
            <div class="floating-input list-btn">
              <select
                class="form-control selectpicker show-tick"
                [(ngModel)]="CURRENCY_CODE"
                disabled
                data-live-search="true"
                title="Search"
              >
                <option
                  *ngFor="let opt of currency_list; let i = index"
                  [selected]="opt.CURRENCY_CODE == this.CURRENCY_CODE"
                  [value]="opt.CURRENCY_CODE"
                  disabled
                >
                  {{ opt.CURRENCY_NAME }}
                </option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <label>Exch.Rate :</label>
            <div class="floating-input">
              <input
                class="form-control cost"
                maxlenght="10"
                [(ngModel)]="EXCHANGE_RATE"
                maxlength="3"
                placeholder="Exchange Rate"
                disabled
              />
            </div>
          </div>
          <div class="col-md-4">
            <label>Credit Note Date :<span class="text-danger">*</span></label>
            <div class="floating-input">
              <input
                type="text"
                class="form-control"
                [(ngModel)]="CREDIT_NOTE_DATE"
                readonly
              />
              <app-date-picker
                [(ngModel)]="CREDIT_NOTE_DATE"
                class="date-input"
                [mindate]="Min_Credit_Note_Date"
                [maxdate]="maxdate"
                [ngModelOptions]="{ standalone: true }"
              ></app-date-picker>
            </div>
          </div>
          <div class="col-md-12">
            <label
              >Credit Note Remarks :<span class="text-danger">*</span></label
            >
            <div class="floating-input">
              <textarea
                [(ngModel)]="REMARKS"
                rows="1"
                class="form-control"
                placeholder="Credit Note Remarks"
              ></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-2">
    <div class="row card">
      <div class="form-inline col-md-12">
        <h6 class="mb-0 col-md-6 p-0">Invoice Details</h6>
        <hr class="m-0 mb-2" />
      </div>
      <div class="col-md-12">
        <div class="tableFixHead">
          <table class="table-theam-1 row_bgcolor_3">
            <thead>
              <tr>
                <th class="w-10">Sr.No</th>
                <th class="w-50">Service</th>
                <th class="w-25">Value</th>
              </tr>
            </thead>
            <tbody *ngFor="let data of _invoice_detail; let i = index">
              <tr>
                <td class="w-10 pb-0 pt-0">{{ i + 1 }}</td>
                <td class="w-50 pb-0" colspan="1">
                  <div class="floating-input">
                    <select
                      class="form-control selectpicker show-tick"
                      [(ngModel)]="data.SERVICE_CODE"
                      disabled
                      id="p_{{ i }}"
                      data-container="body"
                      data-size="5"
                      [ngModelOptions]="{ standalone: true }"
                      data-live-search="true"
                      title="Select"
                    >
                      <option value="" disabled></option>
                      <option
                        *ngFor="let opt of service_list; let i = index"
                        [selected]="opt.SERVICE_CODE == data.SERVICE_CODE"
                        [value]="opt.SERVICE_CODE"
                      >
                        {{ opt.SERVICE_NAME }}
                      </option>
                    </select>
                  </div>
                </td>
                <td class="w-25 pb-0" colspan="1">
                  <div class="floating-input">
                    <input
                      id="val_{{ i }}"
                      type="text"
                      class="form-control cost"
                      disabled
                      [(ngModel)]="data.DOC_VALUE"
                      placeholder="Doc Value"
                      costInput
                      [ngModelOptions]="{ standalone: true }"
                      autocomplete="off"
                    />
                  </div>
                </td>
              </tr>
              <tr>
                <td class="pt-0"></td>
                <td colspan="1" class="">
                  <div class="floating-input">
                    <!-- <input type="text" class="form-control" placeholder="Remarks">  -->
                    <textarea
                      name=""
                      id=""
                      rows="6"
                      class="form-control"
                      disabled
                      maxlength="500"
                      [(ngModel)]="data.REMARKS"
                      placeholder="Remarks"
                      [ngModelOptions]="{ standalone: true }"
                    ></textarea>
                  </div>
                </td>
                <td colspan="1" class="pb-0">
                  <div class="floating-input">
                    <div class="form-inline">
                      <label class="ml-2 font-weight-bold">SGST :</label>
                      <input
                        type="text"
                        class="form-control w-16 ml-1 mr-1 cost"
                        maxlength="10"
                        [(ngModel)]="data.SGST_VALUE"
                        disabled
                        costInput
                        placeholder="SGST Value"
                        [ngModelOptions]="{ standalone: true }"
                      />
                      <label class="ml-1">{{ data.SGST_RATE }}%</label>
                    </div>
                    <div class="form-inline mt-1 mb-1">
                      <label class="ml-2 font-weight-bold">CGST :</label>
                      <input
                        type="text"
                        class="form-control w-16 ml-1 mr-1 cost"
                        maxlength="10"
                        [(ngModel)]="data.CGST_VALUE"
                        disabled
                        costInput
                        placeholder="CGST Value"
                        [ngModelOptions]="{ standalone: true }"
                      />
                      <label class="ml-1">{{ data.CGST_RATE }}%</label>
                    </div>
                    <div class="form-inline">
                      <label class="ml-2 mr-1 font-weight-bold">IGST :</label>
                      <input
                        type="text"
                        class="form-control w-16 ml-1 mr-1 cost"
                        maxlength="10"
                        [(ngModel)]="data.IGST_VALUE"
                        disabled
                        costInput
                        placeholder="IGST Value"
                        [ngModelOptions]="{ standalone: true }"
                      />
                      <label class="ml-1">{{ data.IGST_RATE }}%</label>
                    </div>
                  </div>
                  <div class="floating-input ml-2 form-inline">
                    <label class="font-weight-bold mr-1">Total :</label>
                    <input
                      type="text"
                      class="form-control w-50 mt-1 ml-1 cost"
                      [(ngModel)]="data.TOT_VALUE"
                      disabled
                      costInput
                      placeholder="Total"
                      readonly
                      [ngModelOptions]="{ standalone: true }"
                    />
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!--  -->
      </div>
      <div class="col-md-2">
        <label>Bill Value :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            maxlength="10"
            [(ngModel)]="DOC_VALUE"
            disabled
            costInput
            placeholder="Bill Value"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-2">
        <label>SGST :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            maxlength="10"
            [(ngModel)]="SGST_VALUE"
            disabled
            costInput
            placeholder="SGST"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-2">
        <label>CGST :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            maxlength="10"
            [(ngModel)]="CGST_VALUE"
            disabled
            costInput
            placeholder="CGST"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-2">
        <label>IGST :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            maxlength="10"
            [(ngModel)]="IGST_VALUE"
            disabled
            costInput
            placeholder="IGST"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-2">
        <label>Round Off :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            maxlength="5"
            [(ngModel)]="ROUNDOFF_VALUE"
            disabled
            costInput
            placeholder="Round Off"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-3">
        <label>Final Bill :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            [(ngModel)]="BILL_VALUE"
            maxlength="10"
            disabled
            costInput
            placeholder="Final Bill"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-3">
        <label>Final Base :</label>
        <div class="floating-input">
          <input
            type="text"
            class="form-control text-right"
            [(ngModel)]="BASE_VALUE"
            maxlength="10"
            disabled
            costInput
            placeholder="Final Base"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mt-2" *ngIf="!isViewInvoiceCancle">
  <div class="row">
    <div class="col-md-12">
      <h5 class="formName">{{ sharedService.formName }}</h5>
    </div>
  </div>

  <div class="row card col-md-12">
    <p-table
      #datatable
      [value]="Credit_Note_List"
      [globalFilterFields]="[
        'BILLING_NO',
        'BILLING_DATE',
        'CUSTOMER_NAME',
        'PROJECT_NAME',
        'BILL_VALUE',
        'BASE_VALUE'
      ]"
    >
      <ng-template pTemplate="caption">
        <div class="d-flex justify-content-end">
          <div class="floating-input">
            <input
              type="text"
              pInputText
              size="50"
              class="form-control"
              placeholder="Search"
              (input)="datatable.filterGlobal($event.target.value, 'contains')"
            />
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header" let-flight>
        <tr>
          <th>Billing No</th>
          <th>Billing Date</th>
          <th>Customer Name</th>
          <th>Project Name</th>
          <th>Bill Value</th>
          <th>Base Value</th>
          <th>Action</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-data>
        <tr>
          <td>{{ data.BILLING_NO }}</td>
          <td>{{ data.BILLING_DATE }}</td>
          <td>{{ data.CUSTOMER_NAME }}</td>
          <td>{{ data.PROJECT_NAME }}</td>
          <td>{{ data.BILL_VALUE }}</td>
          <td>{{ data.BASE_VALUE }}</td>
          <td class="">
            <i
              class="fa fa-edit small"
              title="Edit"
              (click)="CancleCreditNote(data)"
            ></i>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<div
  class="modal fade"
  *ngIf="isModalOpen"
  #savecreditnote
  id="savecreditnote"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content mt-5">
      <div class="modal-header header-background py-1">
        <h5 class="modal-title" id="exampleModalLabel">CFTRACK</h5>
      </div>
      <div class="modal-body">
        <label>Are you sure, you want to save this credit note ?</label>
      </div>

      <div class="modal-footer py-0">
        <button
          type="button"
          class="btn btn-primary py-1"
          data-dismiss="isViewInvoiceCancle"
          (click)="SaveCreditNote()"
        >
          Yes
        </button>
        <button type="button" class="btn btn-danger py-1" data-dismiss="modal">
          No
        </button>
      </div>
    </div>
  </div>
</div>
